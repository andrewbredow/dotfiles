- defaults:
    link:
      relink: true
      create: true
    shell:
      stderr: true
      stdout: true

- clean: ['~', '~/.config']

- link:
    ~/.alacritty.yml: configs/alacritty/alacritty.yml
    ~/.agignore: configs/agignore
    ~/.asdfrc: configs/asdf/asdfrc
    ~/.Brewfile: configs/brewfile
    ~/.config/fish: configs/fish
    ~/.config/git: configs/git
    ~/.config/nvim: configs/nvim
    ~/.config/kitty: configs/kitty
    ~/.config/karabiner: configs/karabiner
    ~/.default-gems: configs/default-gems
    ~/.gemrc: configs/gemrc
    ~/.gitconfig: configs/git/config # Legacy git
    ~/.irbrc: configs/irbrc
    ~/.pryrc: configs/pryrc
    ~/.psqlrc: configs/psqlrc
    ~/.rspec: configs/rspec
    ~/.terminfo: configs/terminfo
    ~/.tmux.colors: configs/tmux.colors
    ~/.tmux.conf: configs/tmux.conf
    ~/.tool-versions: configs/asdf/tool-versions
    ~/.vim: configs/nvim # Legacy vim
    ~/.vimrc: configs/nvim/init.vim # Legacy vim
    ~/.zsh: configs/zsh
    ~/.zshrc: configs/zshrc
    ~/Library/Preferences/com.mizage.direct.Divvy.plist:
      force: true
      path: preferences/com.mizage.direct.Divvy.plist
    ~/Library/Preferences/com.pilotmoon.popclip.plist:
      force: true
      path: preferences/com.pilotmoon.popclip.plist
    '~/Library/Application Support/PopClip':
      force: true
      path: preferences/popclip
    ~/Library/Preferences/net.matthewpalmer.Rocket.plist:
      force: true
      path: preferences/net.matthewpalmer.Rocket.plist

- shell:
  # - description: Set Mac defaults
  #   command: bin/macos.sh

  - description: Hush the last login prompt
    command: touch ~/.hushlogin

  - description: Create the local working src folder
    command: mkdir -p ~/src

  - description: Install Homebrew
    command: /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"

  - description: Install system Brewfile
    command: brew bundle --global

  ## Todo: Install heroku plugins: heroku-accounts, heroku-pg-extras

  - description: Install login items
    command: bin/login-items.sh
    stdout: false

  - description: Clone base16 shell colors
    command: |
      if [ -d "~/.config/base16-shell" ] then
        cd ~/.config
        git fetch
        git reset --hard origin/master
      else
        git clone https://github.com/chriskempson/base16-shell.git ~/.config/base16-shell
      fi

  - description: install fisher package manager
    command: curl https://git.io/fisher --create-dirs -sLo ~/.config/fish/functions/fisher.fish

  - description: Set shell to fish
    command: |
      grep -qxF '/usr/local/bin/fish' /etc/shells || echo '/usr/local/bin/fish' | sudo tee -a /etc/shells
      chsh -s /usr/local/bin/fish

  - description: Install ASDF plugins
    command: asdf plugin add ruby && asdf plugin add erlang && asdf plugin add elixir && asdf plugin add nodejs

  - description: Install ASDF runtimes
    command: cd && asdf install

  - description: Install vim-plug
    command: curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

  - description: Install vim plugins
    command: nvim -u ~/.config/nvim/plugs.vim +PlugInstall +qall
